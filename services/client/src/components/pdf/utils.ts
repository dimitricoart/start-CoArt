import { pdfjs } from "react-pdf";
import "pdfjs-dist/build/pdf.worker.min.mjs";

export const isPdfJsSupported = async () => {
  // old Safari has no URL.parse
  if (typeof URL === "undefined" || typeof URL.parse === "undefined") {
    return false;
  }

  // pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.js`;

  try {
    const loadingTask = pdfjs.getDocument({
      data: new Uint8Array([
        0x25,
        0x50,
        0x44,
        0x46,
        0x2d,
        0x31,
        0x2e,
        0x34,
        0x0a, // %PDF-1.4\n
        0x31,
        0x20,
        0x30,
        0x20,
        0x6f,
        0x62,
        0x6a,
        0x0a, // 1 0 obj\n
        0x3c,
        0x3c,
        0x2f,
        0x54,
        0x79,
        0x70,
        0x65,
        0x2f, // <</Type/
        0x43,
        0x61,
        0x74,
        0x61,
        0x6c,
        0x6f,
        0x67,
        0x2f, // Catalog/
        0x50,
        0x61,
        0x67,
        0x65,
        0x73,
        0x20,
        0x32,
        0x20, // Pages 2
        0x30,
        0x20,
        0x52,
        0x3e,
        0x3e,
        0x0a, // 0 R>>\n
        0x65,
        0x6e,
        0x64,
        0x6f,
        0x62,
        0x6a,
        0x0a, // endobj\n
        0x32,
        0x20,
        0x30,
        0x20,
        0x6f,
        0x62,
        0x6a,
        0x0a, // 2 0 obj\n
        0x3c,
        0x3c,
        0x2f,
        0x54,
        0x79,
        0x70,
        0x65,
        0x2f, // <</Type/
        0x50,
        0x61,
        0x67,
        0x65,
        0x73,
        0x2f,
        0x43,
        0x6f, // Pages/Co
        0x75,
        0x6e,
        0x74,
        0x20,
        0x30,
        0x3e,
        0x3e,
        0x0a, // unt 0>>\n
        0x65,
        0x6e,
        0x64,
        0x6f,
        0x62,
        0x6a,
        0x0a, // endobj\n
        0x78,
        0x72,
        0x65,
        0x66,
        0x0a, // xref\n
        0x30,
        0x20,
        0x33,
        0x0a, // 0 3\n
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30, // 00000000
        0x30,
        0x30,
        0x20,
        0x36,
        0x35,
        0x35,
        0x33,
        0x35, // 00 65535
        0x20,
        0x66,
        0x0a, //  f\n
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30, // 00000000
        0x30,
        0x39,
        0x20,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30, // 09 00000
        0x20,
        0x6e,
        0x0a, //  n\n
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30, // 00000000
        0x35,
        0x38,
        0x20,
        0x30,
        0x30,
        0x30,
        0x30,
        0x30, // 58 00000
        0x20,
        0x6e,
        0x0a, //  n\n
        0x74,
        0x72,
        0x61,
        0x69,
        0x6c,
        0x65,
        0x72,
        0x0a, // trailer\n
        0x3c,
        0x3c,
        0x2f,
        0x53,
        0x69,
        0x7a,
        0x65,
        0x20, // <</Size
        0x33,
        0x2f,
        0x52,
        0x6f,
        0x6f,
        0x74,
        0x20,
        0x31, // 3/Root 1
        0x20,
        0x30,
        0x20,
        0x52,
        0x3e,
        0x3e,
        0x0a, //  0 R>>\n
        0x73,
        0x74,
        0x61,
        0x72,
        0x74,
        0x78,
        0x72,
        0x65, // startxre
        0x66,
        0x0a, // f\n
        0x31,
        0x30,
        0x37,
        0x0a, // 107\n
        0x25,
        0x25,
        0x45,
        0x4f,
        0x46, // %%EOF
      ]),
    });
    const pdf = await loadingTask.promise;
    await pdf.destroy();
    return true;
  } catch (e) {
    void e;
    return false;
  }
};
